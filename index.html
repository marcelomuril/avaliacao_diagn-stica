<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Apresentação dos Resultados da 1ª Avaliação Diagnóstica 2025</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f8f9fa;
        }
        header {
            text-align: center;
            margin-bottom: 20px;
        }
        select, button {
            margin: 5px;
            padding: 8px;
        }
        canvas {
            max-width: 800px;
            margin: 20px auto;
            display: block;
        }
        #descritor-info {
            max-width: 800px;
            margin: 20px auto;
            padding: 15px;
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <header>
        <h1>CCM SEBASTIÃO PARANÁ</h1>
        <h2>Apresentação dos Resultados da 1ª Avaliação Diagnóstica 2025</h2>
    </header>

    <section>
        <label for="serie">Selecione a Série:</label>
        <select id="serie">
            <option value="">-- Escolha --</option>
            <option value="3">3º Ano</option>
            <option value="9">9º Ano</option>
        </select>

        <label for="aluno">Selecione o Aluno:</label>
        <select id="aluno" disabled>
            <option value="">-- Escolha um aluno --</option>
        </select>
    </section>

    <canvas id="grafico"></canvas>

    <div id="descritor-info">
        <h3>Informações dos Descritores</h3>
        <div id="descritor-texto">Selecione um aluno para ver os detalhes.</div>
    </div>

    <script>
        // Descrições breves dos descritores
        const descricoes = {
            "H01": "H01: Avalia a compreensão leitora básica. Dominar este descritor é essencial para interpretar textos simples.",
            "H02": "H02: Refere-se à interpretação de informações explícitas em textos. Falhas aqui dificultam compreensão geral.",
            "H03": "H03: Mede a capacidade de inferir informações implícitas. Importante para análises mais profundas.",
            "H04": "H04: Relaciona-se à identificação de ideias principais. Não dominar pode comprometer a síntese de conteúdos.",
            "H05": "H05: Avalia habilidades de vocabulário contextual. Essencial para compreensão detalhada.",
            "H06": "H06: Analisa raciocínio lógico-matemático básico. Sem isso, operações fundamentais ficam prejudicadas.",
            "H07": "H07: Mede a resolução de problemas simples. A falta de domínio impacta a aplicação prática do conhecimento.",
            "H08": "H08: Foca na análise crítica de informações. Essencial para leitura crítica e tomada de decisão."
        };

        const arquivos = {
            3: ["mat3.csv", "port3.csv"],
            9: ["mat9.csv", "port9.csv"]
        };

        let dadosAlunos = {};
        let grafico = null;

        // Carregar CSV e transformar em objeto
        async function carregarCSV(serie) {
            dadosAlunos = {};
            const files = arquivos[serie];

            for (const file of files) {
                const response = await fetch(file);
                const text = await response.text();
                const linhas = text.trim().split("\n");
                const headers = linhas.shift().split(",");

                linhas.forEach(linha => {
                    const valores = linha.split(",");
                    const aluno = valores[1];
                    if (!dadosAlunos[aluno]) {
                        dadosAlunos[aluno] = { "Níveis de Aprendizagem": 0, descritores: {} };
                    }
                    dadosAlunos[aluno]["Níveis de Aprendizagem"] += Number(valores[3]); // soma o nível geral
                    headers.slice(4).forEach((h, i) => {
                        dadosAlunos[aluno].descritores[h] = Number(valores[4 + i]);
                    });
                });
            }
            preencherAlunos();
        }

        function preencherAlunos() {
            const select = document.getElementById("aluno");
            select.innerHTML = '<option value="">-- Escolha um aluno --</option>';
            Object.keys(dadosAlunos).forEach(aluno => {
                const option = document.createElement("option");
                option.value = aluno;
                option.textContent = aluno;
                select.appendChild(option);
            });
            select.disabled = false;
        }

        function exibirGrafico(aluno) {
            const ctx = document.getElementById("grafico").getContext("2d");
            const data = dadosAlunos[aluno];
            const labels = ["Nível Geral", ...Object.keys(data.descritores)];
            const valores = [data["Níveis de Aprendizagem"], ...Object.values(data.descritores)];

            if (grafico) grafico.destroy();

            grafico = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: "Desempenho",
                        data: valores,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.6)', // vermelho para nível geral
                            ...Array(labels.length - 1).fill('rgba(54, 162, 235, 0.6)') // azul para descritores
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    animation: false, // evita bug de "encolher" ao passar o mouse
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            enabled: true,
                            animation: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10
                        }
                    }
                }
            });

            atualizarDescricoes(data.descritores);
        }

        function atualizarDescricoes(descritores) {
            const container = document.getElementById("descritor-texto");
            container.innerHTML = "";
            for (const [chave, valor] of Object.entries(descritores)) {
                const p = document.createElement("p");
                p.textContent = `${descricoes[chave]} (Nível: ${valor})`;
                container.appendChild(p);
            }
        }

        document.getElementById("serie").addEventListener("change", (e) => {
            const serie = e.target.value;
            if (serie) carregarCSV(serie);
        });

        document.getElementById("aluno").addEventListener("change", (e) => {
            const aluno = e.target.value;
            if (aluno) exibirGrafico(aluno);
        });
    </script>
</body>
</html>

